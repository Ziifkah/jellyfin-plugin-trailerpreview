<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Trailer Preview</title>
</head>
<body>
    <div id="TrailerPreviewConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="TrailerPreviewConfigForm">

                    <h2>Trailer Preview Configuration</h2>
                    <p>Configure how trailer previews appear when hovering over movies and TV shows.</p>

                    <!-- General Settings -->
                    <div class="verticalSection">
                        <h3 class="sectionTitle">General Settings</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="enableTrailerPreview" />
                                <span>Enable Trailer Preview</span>
                            </label>
                            <div class="fieldDescription">Enable or disable the trailer preview feature</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="enableDebugLogging" />
                                <span>Enable Debug Logging</span>
                            </label>
                            <div class="fieldDescription">Show debug messages in browser console</div>
                        </div>
                    </div>

                    <!-- Timing Settings -->
                    <div class="verticalSection">
                        <h3 class="sectionTitle">Timing Settings</h3>

                        <div class="inputContainer">
                            <label for="hoverDelayMs">Hover Delay (ms):</label>
                            <input type="number" is="emby-input" id="hoverDelayMs" min="0" max="5000" step="100" />
                            <div class="fieldDescription">Time to wait before showing preview after hovering</div>
                        </div>

                        <div class="inputContainer">
                            <label for="previewDurationMs">Preview Duration (ms):</label>
                            <input type="number" is="emby-input" id="previewDurationMs" min="5000" max="120000" step="1000" />
                            <div class="fieldDescription">How long to show the preview (0 = no limit)</div>
                        </div>

                        <div class="inputContainer">
                            <label for="fadeInDurationMs">Fade In Duration (ms):</label>
                            <input type="number" is="emby-input" id="fadeInDurationMs" min="0" max="2000" step="50" />
                            <div class="fieldDescription">Animation time when preview appears</div>
                        </div>

                        <div class="inputContainer">
                            <label for="fadeOutDurationMs">Fade Out Duration (ms):</label>
                            <input type="number" is="emby-input" id="fadeOutDurationMs" min="0" max="2000" step="50" />
                            <div class="fieldDescription">Animation time when preview disappears</div>
                        </div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var TrailerPreviewConfig = {
            pluginUniqueId: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'
        };

        function loadConfiguration() {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(TrailerPreviewConfig.pluginUniqueId).then(function(config) {
                // General - Use defaults if values are undefined
                document.querySelector('#enableTrailerPreview').checked = config.EnableTrailerPreview !== false;
                document.querySelector('#enableDebugLogging').checked = config.EnableDebugLogging || false;

                // Timing
                document.querySelector('#hoverDelayMs').value = config.HoverDelayMs || 800;
                document.querySelector('#previewDurationMs').value = config.PreviewDurationMs || 30000;
                document.querySelector('#fadeInDurationMs').value = config.FadeInDurationMs || 300;
                document.querySelector('#fadeOutDurationMs').value = config.FadeOutDurationMs || 200;

                Dashboard.hideLoadingMsg();
            }).catch(function(error) {
                console.error('Error loading configuration:', error);
                Dashboard.hideLoadingMsg();
                Dashboard.alert('Error loading configuration: ' + error.message);
            });
        }

        function saveConfiguration() {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(TrailerPreviewConfig.pluginUniqueId).then(function(config) {
                // General
                config.EnableTrailerPreview = document.querySelector('#enableTrailerPreview').checked;
                config.EnableDebugLogging = document.querySelector('#enableDebugLogging').checked;

                // Timing
                config.HoverDelayMs = parseInt(document.querySelector('#hoverDelayMs').value) || 800;
                config.PreviewDurationMs = parseInt(document.querySelector('#previewDurationMs').value) || 30000;
                config.FadeInDurationMs = parseInt(document.querySelector('#fadeInDurationMs').value) || 300;
                config.FadeOutDurationMs = parseInt(document.querySelector('#fadeOutDurationMs').value) || 200;

                ApiClient.updatePluginConfiguration(TrailerPreviewConfig.pluginUniqueId, config).then(function(result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                }).catch(function(error) {
                    console.error('Error saving configuration:', error);
                    Dashboard.hideLoadingMsg();
                    Dashboard.alert('Error saving configuration: ' + error.message);
                });
            }).catch(function(error) {
                console.error('Error loading configuration for save:', error);
                Dashboard.hideLoadingMsg();
                Dashboard.alert('Error loading configuration: ' + error.message);
            });
        }

        document.querySelector('#TrailerPreviewConfigPage').addEventListener('pageshow', function() {
            loadConfiguration();
        });

        document.querySelector('#TrailerPreviewConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveConfiguration();
            return false;
        });
    </script>
</body>
</html>
